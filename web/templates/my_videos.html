{% extends "base.html" %}

{% block title %}My Videos - KyleAI{% endblock %}

{% block content %}
  <h1>My Videos</h1>
  
  <div class="button-group" style="margin-bottom: 2em;">
    <a href="/upload/" class="btn-primary">Generate New Video</a>
  </div>

  {% if error %}
    <div class="alert alert-error">
      <p><strong>Error:</strong> {{ error }}</p>
    </div>
  {% endif %}

  {% if videos %}
    <div class="videos-list">
      {% for video in videos %}
        <div class="video-card">
          <div class="video-card-header">
            <div class="video-card-info">
              <h3>
                <a href="/status/{{ video.paper_id }}/">{{ video.paper_id }}</a>
              </h3>
              <p class="video-meta">
                Created: {{ video.created_at|date:"F d, Y H:i" }}
                {% if video.completed_at %}
                  <br>Completed: {{ video.completed_at|date:"F d, Y H:i" }}
                {% endif %}
              </p>
            </div>
            <div class="video-status">
              {% if video.status == "completed" %}
                <span class="status-badge status-completed">✓ Completed</span>
              {% elif video.status == "running" %}
                <span class="status-badge status-running">⟳ Running</span>
              {% elif video.status == "pending" %}
                <span class="status-badge status-pending">⏳ Pending</span>
              {% elif video.status == "failed" %}
                <span class="status-badge status-failed">✗ Failed</span>
              {% endif %}
            </div>
          </div>

          {% if video.status == "running" or video.status == "pending" %}
            <div class="video-progress">
              <div class="progress-bar-container">
                <div class="progress-bar" style="width: {{ video.progress_percent }}%;"></div>
              </div>
              <p class="progress-text">
                {{ video.progress_percent }}% complete
                {% if video.current_step %}
                  - {{ video.current_step }}
                {% endif %}
              </p>
            </div>
            <div class="button-group">
              <a href="/status/{{ video.paper_id }}/" class="btn-secondary">View Status</a>
            </div>
          {% elif video.status == "completed" %}
            <div class="button-group">
              <a href="/result/{{ video.paper_id }}/" class="btn-primary">View Result</a>
              <a href="/status/{{ video.paper_id }}/" class="btn-secondary">View Details</a>
            </div>
          {% elif video.status == "failed" %}
            <div class="alert alert-error">
              <p>
                <strong>Error:</strong>
                {% if video.error_message %}
                  {{ video.error_message|truncatewords:30 }}
                {% else %}
                  Video generation failed. Please try again.
                {% endif %}
              </p>
            </div>
            <div class="button-group">
              <a href="/status/{{ video.paper_id }}/" class="btn-secondary">View Details</a>
              <a href="/upload/" class="btn-primary">Try Again</a>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty-state">
      <p>You haven't generated any videos yet.</p>
      <a href="/upload/" class="btn-primary">Generate Your First Video</a>
    </div>
  {% endif %}
{% endblock %}

